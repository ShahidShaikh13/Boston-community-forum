<div class="mb-6">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1>All Posts</h1>
      <p class="text-muted">Browse and filter posts from the community</p>
    </div>
    <% if user_signed_in? %>
      <%= link_to new_post_path, class: "btn btn-primary" do %>
        <i class="fas fa-plus"></i>
        New Post
      <% end %>
    <% end %>
  </div>
  
  <!-- Filters -->
  <div class="card mb-6">
    <h3 class="card-title mb-4">Filters</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="form-group">
        <label class="form-label">Category</label>
        <%= select_tag :category_id, 
            options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
            prompt: "All Categories",
            class: "form-select",
            onchange: "this.form.submit()" %>
      </div>
      
      <div class="form-group">
        <label class="form-label">College</label>
        <%= select_tag :college, 
            options_for_select(@colleges, params[:college]),
            prompt: "All Colleges",
            class: "form-select",
            onchange: "this.form.submit()" %>
      </div>
      
      <div class="form-group">
        <label class="form-label">Sort</label>
        <%= select_tag :sort, 
            options_for_select([
              ['Newest First', 'recent'],
              ['Oldest First', 'oldest'],
              ['Most Comments', 'comments'],
              ['Most Votes', 'votes']
            ], params[:sort]),
            class: "form-select",
            onchange: "this.form.submit()" %>
      </div>
    </div>
  </div>
</div>

<% if @posts.any? %>
  <div class="space-y-4">
    <% @posts.each do |post| %>
      <div class="post-preview" id="post-<%= post.id %>">
        <div class="flex items-center gap-2 mb-3">
          <span class="college-badge">
            <i class="fas fa-university"></i>
            <%= post.user.college %>
          </span>
          <span class="text-sm text-muted">
            <i class="fas fa-folder"></i>
            <%= post.category.name %>
          </span>
          <% if post.pinned? %>
            <span class="text-sm text-success">
              <i class="fas fa-thumbtack"></i>
              Pinned
            </span>
          <% end %>
        </div>
        
        <h3>
          <%= link_to post.title, post_path(post) %>
        </h3>
        
        <p><%= post.excerpt %></p>
        
        <!-- Voting Section -->
        <div class="flex items-center gap-4 mb-3">
          <div class="flex items-center gap-2">
            <%= button_to upvote_post_path(post), 
                method: :post, 
                class: "btn btn-sm vote-btn upvote-btn",
                data: { post_id: post.id, action: 'upvote' },
                remote: true do %>
              <i class="fas fa-thumbs-up"></i>
            <% end %>
            <span class="font-semibold vote-score" data-post-id="<%= post.id %>">
              <%= post.vote_score %>
            </span>
            <%= button_to downvote_post_path(post), 
                method: :post, 
                class: "btn btn-sm vote-btn downvote-btn",
                data: { post_id: post.id, action: 'downvote' },
                remote: true do %>
              <i class="fas fa-thumbs-down"></i>
            <% end %>
          </div>
          <div class="text-sm text-muted vote-counts" data-post-id="<%= post.id %>">
            <%= pluralize(post.upvotes || 0, 'upvote') %> â€¢ 
            <%= pluralize(post.downvotes || 0, 'downvote') %>
          </div>
        </div>
        
        <div class="flex items-center justify-between text-sm text-muted">
          <div class="flex items-center gap-4">
            <span>
              <i class="fas fa-user"></i>
              <%= post.user.display_name %>
            </span>
            <span>
              <i class="fas fa-clock"></i>
              <%= time_ago_in_words(post.created_at) %> ago
            </span>
            <span>
              <i class="fas fa-comments"></i>
              <%= post.comments_count %> comments
            </span>
          </div>
          
          <% if user_signed_in? && post.user == current_user %>
            <div class="flex gap-2">
              <%= link_to edit_post_path(post), class: "btn btn-secondary btn-sm" do %>
                <i class="fas fa-edit"></i>
                Edit
              <% end %>
              <%= button_to post_path(post), method: :delete, 
                  class: "btn btn-danger btn-sm", 
                  data: { confirm: "Are you sure you want to delete this post?" } do %>
                <i class="fas fa-trash"></i>
                Delete
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  
  <!-- Pagination -->
  <div class="pagination">
    <%= paginate @posts %>
  </div>
<% else %>
  <div class="card text-center py-12">
    <i class="fas fa-inbox text-4xl text-muted mb-4"></i>
    <h3 class="text-xl font-semibold mb-2">No posts found</h3>
    <p class="text-muted mb-4">Try adjusting your filters or create the first post!</p>
    <% if user_signed_in? %>
      <%= link_to new_post_path, class: "btn btn-primary" do %>
        <i class="fas fa-plus"></i>
        Create First Post
      <% end %>
    <% else %>
      <%= link_to new_user_registration_path, class: "btn btn-primary" do %>
        <i class="fas fa-user-plus"></i>
        Sign Up to Post
      <% end %>
    <% end %>
  </div>
<% end %>

<script>
// Enhanced voting with visual feedback
document.addEventListener('DOMContentLoaded', function() {
  const voteButtons = document.querySelectorAll('.vote-btn');
  
  voteButtons.forEach(button => {
    button.addEventListener('click', function(e) {
      const postId = this.dataset.postId;
      const action = this.dataset.action;
      
      // Add visual feedback
      this.style.transform = 'scale(0.95)';
      setTimeout(() => {
        this.style.transform = 'scale(1)';
      }, 150);
      
      // Update vote count immediately for better UX
      const scoreElement = document.querySelector(`[data-post-id="${postId}"].vote-score`);
      const currentScore = parseInt(scoreElement.textContent);
      
      if (action === 'upvote') {
        scoreElement.textContent = currentScore + 1;
      } else if (action === 'downvote') {
        scoreElement.textContent = currentScore - 1;
      }
    });
  });
});
</script>
